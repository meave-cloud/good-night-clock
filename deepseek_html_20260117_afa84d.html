<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘ä»¬ä¸€èµ·æ—©ç¡å§ï¼</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans SC', sans-serif;
        }

        :root {
            --primary-yellow: #FFEB3B;
            --secondary-yellow: #FFF59D;
            --dark-yellow: #FBC02D;
            --accent-yellow: #FFD600;
            --text-dark: #333;
            --text-light: #666;
            --white: #FFFFFF;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #4CAF50;
            --warning: #FF9800;
            --late-color: #FF5722;
            --irregular-color: #9E9E9E;
        }

        body {
            background-color: var(--primary-yellow);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* ç…§ç‰‡å¢™èƒŒæ™¯ */
        .photo-wall-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.25;
            overflow: hidden;
        }

        .photo-scroll-container {
            display: flex;
            width: 400%;
            height: 100%;
            animation: scrollBackground 80s linear infinite;
        }

        .photo-scroll-container img {
            width: 25%;
            height: 100%;
            object-fit: cover;
            filter: sepia(0.3) brightness(0.9);
        }

        @keyframes scrollBackground {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: rgba(255, 214, 0, 0.95);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 30px;
            border-radius: 0 0 25px 25px;
            position: relative;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        header h1 i {
            color: var(--text-dark);
        }

        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-btn {
            background-color: var(--white);
            color: var(--text-dark);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px var(--shadow);
            font-size: 1rem;
        }

        .nav-btn:hover {
            background-color: var(--secondary-yellow);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px var(--shadow);
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            margin-bottom: 25px;
            border: 3px solid var(--dark-yellow);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-yellow);
        }

        /* æ‰“å¡åŒºåŸŸ */
        .clock-in-section {
            position: relative;
        }

        .clock-in-section .card {
            background-color: rgba(255, 245, 157, 0.95);
        }

        .current-time {
            font-size: 2.2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-dark);
            padding: 25px 20px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--dark-yellow));
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(251, 192, 45, 0.3);
        }

        .clock-in-btn {
            display: block;
            width: 100%;
            padding: 25px;
            background: linear-gradient(135deg, var(--success), #3d8b40);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .clock-in-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
        }

        .clock-in-btn:disabled {
            background: linear-gradient(135deg, #cccccc, #aaaaaa);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .clock-in-btn.late {
            background: linear-gradient(135deg, var(--late-color), #d84315);
            box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
        }

        .clock-in-btn.late:hover {
            box-shadow: 0 8px 25px rgba(255, 87, 34, 0.5);
        }

        .clock-in-btn.irregular {
            background: linear-gradient(135deg, var(--irregular-color), #757575);
            box-shadow: 0 6px 20px rgba(158, 158, 158, 0.4);
        }

        .clock-in-btn.irregular:hover {
            box-shadow: 0 8px 25px rgba(158, 158, 158, 0.5);
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            text-align: center;
            margin-top: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-dot.early { background-color: var(--success); }
        .status-dot.late { background-color: var(--late-color); }
        .status-dot.irregular { background-color: var(--irregular-color); }

        /* æˆå‘˜çŠ¶æ€åŒºåŸŸ */
        .members-section h2 {
            color: var(--text-dark);
        }

        .members-status {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            min-height: 200px;
        }

        .member-card {
            background-color: rgba(255, 245, 157, 0.9);
            padding: 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 3px solid var(--dark-yellow);
            transition: all 0.3s;
            box-shadow: 0 4px 10px var(--shadow);
        }

        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .member-card.clocked-in-early {
            border-color: var(--success);
            background-color: rgba(232, 245, 233, 0.95);
        }

        .member-card.clocked-in-late {
            border-color: var(--late-color);
            background-color: rgba(255, 236, 230, 0.95);
        }

        .member-card.clocked-in-irregular {
            border-color: var(--irregular-color);
            background-color: rgba(245, 245, 245, 0.95);
        }

        /* å¤´åƒæ ·å¼ - ä¿®å¤ç‰ˆ */
        .member-avatar {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: 4px solid var(--accent-yellow);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--accent-yellow);
            font-size: 2.2rem; /* è°ƒæ•´è¡¨æƒ…ç¬¦å·å¤§å° */
            font-weight: normal;
            overflow: hidden;
        }

        /* å‘æ—¥è‘µå¤´åƒç‰¹æ®Šæ ·å¼ */
        .member-avatar.sunflower {
            background: linear-gradient(135deg, #FFD600, #FBC02D);
            color: #333;
            font-size: 2.5rem;
        }

        .member-avatar.emoji {
            background: linear-gradient(135deg, #FFD600, #FBC02D);
            color: #333;
        }

        .member-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .member-info h4 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .member-info p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .streak-badge {
            background: linear-gradient(135deg, var(--accent-yellow), var(--dark-yellow));
            color: var(--text-dark);
            font-size: 0.85rem;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }
            
            .card {
                padding: 25px;
            }
            
            .clock-in-btn {
                padding: 20px;
                font-size: 1.5rem;
            }
            
            .members-status {
                grid-template-columns: 1fr 1fr;
            }
            
            .photo-scroll-container {
                width: 800%;
                animation-duration: 120s;
            }
            
            .nav-btn {
                padding: 10px 20px;
                font-size: 0.95rem;
            }
            
            .current-time {
                font-size: 1.8rem;
                padding: 20px 15px;
            }
            
            .member-avatar {
                width: 55px;
                height: 55px;
                font-size: 1.8rem;
            }
            
            .member-avatar.sunflower {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .members-status {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .current-time {
                font-size: 1.5rem;
            }
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: var(--white);
            padding: 40px;
            border-radius: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 5px solid var(--accent-yellow);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal h2 {
            font-size: 2.2rem;
            margin-bottom: 25px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .modal p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* ç»Ÿè®¡é¡µé¢æ ·å¼ */
        .stats-page {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 245, 157, 0.9), rgba(255, 214, 0, 0.9));
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            border: 3px solid var(--dark-yellow);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-desc {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* æ—¥å† */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 35px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background-color: var(--secondary-yellow);
            font-weight: bold;
            border: 3px solid transparent;
            position: relative;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .calendar-day.clocked-early {
            background: linear-gradient(135deg, var(--success), #4CAF50);
            color: white;
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.4);
        }

        .calendar-day.clocked-late {
            background: linear-gradient(135deg, var(--late-color), #FF5722);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 87, 34, 0.4);
        }

        .calendar-day.clocked-irregular {
            background: linear-gradient(135deg, var(--irregular-color), #757575);
            color: white;
            box-shadow: 0 3px 8px rgba(158, 158, 158, 0.4);
        }

        .calendar-day.today {
            border-color: var(--dark-yellow);
            background: linear-gradient(135deg, var(--accent-yellow), var(--dark-yellow));
            color: var(--text-dark);
            box-shadow: 0 4px 10px rgba(251, 192, 45, 0.4);
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* å¾½ç« åŒºåŸŸ */
        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .badge {
            width: 110px;
            height: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--white), #f9f9f9);
            border-radius: 20px;
            padding: 15px;
            border: 3px solid var(--dark-yellow);
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .badge.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .badge-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--dark-yellow);
        }

        .badge-name {
            font-size: 0.95rem;
            text-align: center;
            font-weight: bold;
            color: var(--text-dark);
        }

        /* è¿”å›æŒ‰é’® */
        .back-btn {
            background: linear-gradient(135deg, var(--accent-yellow), var(--dark-yellow));
            color: var(--text-dark);
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(251, 192, 45, 0.3);
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(251, 192, 45, 0.4);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-light);
            background-color: rgba(255, 245, 157, 0.5);
            border-radius: 20px;
            border: 3px dashed var(--dark-yellow);
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 25px;
            color: var(--dark-yellow);
        }

        .empty-state p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .progress-bar {
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-yellow), var(--dark-yellow));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
        .file-input {
            display: none;
        }

        /* é¡¶éƒ¨å¯¼èˆªæŒ‰é’®å®¹å™¨ */
        .top-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* å¼¹çª—å…³é—­æŒ‰é’® */
        .modal-close-btn {
            background: linear-gradient(135deg, var(--accent-yellow), var(--dark-yellow));
            color: var(--text-dark);
            border: none;
            padding: 12px 30px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(251, 192, 45, 0.3);
        }
        
        .modal-close-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(251, 192, 45, 0.4);
        }
    </style>
</head>
<body>
    <!-- ç…§ç‰‡å¢™èƒŒæ™¯ -->
    <div class="photo-wall-background">
        <div class="photo-scroll-container" id="photo-scroll-container">
            <!-- ç…§ç‰‡ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- æ‰“å¡æˆåŠŸå¼¹çª— -->
    <div class="modal" id="success-modal">
        <div class="modal-content">
            <h2 id="modal-title"><i class="fas fa-check-circle"></i> <span id="modal-status-text">æ‰“å¡æˆåŠŸï¼</span></h2>
            <p id="success-message">æ‚¨å·²è¿ç»­<span id="streak-days">0</span>å¤©ï¼</p>
            <audio id="encouragement-audio" preload="auto"></audio>
            <button class="modal-close-btn" id="modal-close-btn">ç¡®å®š</button>
        </div>
    </div>

    <!-- ä¸»é¡µ -->
    <div id="home-page">
        <header>
            <div class="container">
                <h1><i class="fas fa-moon"></i> æˆ‘ä»¬ä¸€èµ·æ—©ç¡å§ï¼ <i class="fas fa-bed"></i></h1>
                
                <div class="top-nav">
                    <button class="nav-btn" id="stats-page-btn">
                        <i class="fas fa-chart-line"></i> ç¡çœ è½¨è¿¹
                    </button>
                    <!-- ä»Šæ—¥ä»½å¿«ä¹æŒ‰é’®ç§»åˆ°é¡¶éƒ¨ -->
                    <button class="nav-btn" id="happiness-btn">
                        <i class="fas fa-camera"></i> ä»Šæ—¥ä»½å¿«ä¹
                    </button>
                    <button class="nav-btn" id="settings-btn">
                        <i class="fas fa-cog"></i> è®¾ç½®
                    </button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="main-content">
                <!-- æ‰“å¡åŒºåŸŸ -->
                <section class="clock-in-section">
                    <div class="card">
                        <h2><i class="fas fa-clock"></i> ä»Šæ™šæ‰“å¡</h2>
                        <div class="current-time" id="current-time">21:45:30</div>
                        
                        <button class="clock-in-btn pulse" id="clock-in-btn">ç«‹å³æ‰“å¡</button>
                        
                        <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                        <div class="status-indicator" id="status-indicator">
                            <span class="status-dot early"></span>æ—©ç¡æ—¶é—´ 21:00-22:50
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="nav-btn" id="reset-data-btn" style="font-size: 0.9rem; padding: 8px 16px;">
                                <i class="fas fa-redo"></i> é‡ç½®æ•°æ®
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- æˆå‘˜çŠ¶æ€åŒºåŸŸ -->
                <section class="members-section">
                    <div class="card">
                        <h2><i class="fas fa-users"></i> å¥½å‹çŠ¶æ€</h2>
                        <p style="margin-bottom: 20px; color: var(--text-light);">çœ‹çœ‹è°è¿˜æ²¡ç¡ï¼Ÿäº’ç›¸ç£ä¿ƒå§ï¼</p>
                        
                        <div class="members-status" id="members-status">
                            <!-- æˆå‘˜å¡ç‰‡ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <!-- æ·»åŠ å¥½å‹æŒ‰é’® -->
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="nav-btn" id="add-friend-btn">
                                <i class="fas fa-user-plus"></i> æ·»åŠ å¥½å‹
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡é¡µé¢ï¼ˆç¡çœ è½¨è¿¹ï¼‰ -->
    <div id="stats-page" class="stats-page">
        <header>
            <div class="container">
                <h1><i class="fas fa-chart-line"></i> ç¡çœ è½¨è¿¹</h1>
                
                <div class="top-nav">
                    <button class="back-btn" id="back-to-home-btn">
                        <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
                    </button>
                    <!-- ä»Šæ—¥ä»½å¿«ä¹æŒ‰é’®åœ¨ç»Ÿè®¡é¡µé¢ä¹Ÿæ˜¾ç¤º -->
                    <button class="nav-btn" id="happiness-btn-stats">
                        <i class="fas fa-camera"></i> ä»Šæ—¥ä»½å¿«ä¹
                    </button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- ç»Ÿè®¡åŒºåŸŸ -->
            <section>
                <div class="card">
                    <h2><i class="fas fa-chart-pie"></i> æˆ‘çš„æ•°æ®</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>æœ¬å‘¨æ—©ç¡ç‡</h3>
                            <div class="stat-value" id="week-rate">0%</div>
                            <p class="stat-desc">ç»§ç»­ä¿æŒï¼</p>
                        </div>
                        <div class="stat-card">
                            <h3>æœ¬æœˆæ—©ç¡ç‡</h3>
                            <div class="stat-value" id="month-rate">0%</div>
                            <p class="stat-desc">å¥åº·ä½œæ¯ç»Ÿè®¡</p>
                        </div>
                        <div class="stat-card">
                            <h3>æ€»æ‰“å¡å¤©æ•°</h3>
                            <div class="stat-value" id="total-days">0å¤©</div>
                            <p class="stat-desc">åšæŒå°±æ˜¯èƒœåˆ©</p>
                        </div>
                        <div class="stat-card">
                            <h3>è¿ç»­æ—©ç¡</h3>
                            <div class="stat-value" id="my-streak">0å¤©</div>
                            <p class="stat-desc">å½“å‰è¿ç»­è®°å½•</p>
                        </div>
                    </div>
                    
                    <!-- è¿›åº¦æ¡ -->
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>æœ¬æœˆæ—©ç¡è¿›åº¦</span>
                            <span id="month-progress-text">0/30å¤©</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="month-progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®å¯¼å‡ºæŒ‰é’® -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="nav-btn" id="export-data-btn">
                            <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- æ—¥å†è§†å›¾ -->
            <section>
                <div class="card">
                    <h2><i class="fas fa-calendar-alt"></i> æ‰“å¡æ—¥å†</h2>
                    <p style="margin-bottom: 20px; color: var(--text-light);">ç»¿è‰²=æ—©ç¡ï¼Œæ©™è‰²=æ™šç¡ï¼Œç°è‰²=ä¸è§„å¾‹</p>
                    
                    <div class="calendar" id="calendar">
                        <!-- æ—¥å†å¤©æ•°ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </section>
            
            <!-- å¾½ç« åŒºåŸŸ -->
            <section>
                <div class="card">
                    <h2><i class="fas fa-trophy"></i> ç¡çœ æˆå°±</h2>
                    <div class="badges-container" id="badges-container">
                        <!-- å¾½ç« ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- è®¾ç½®é¡µé¢ -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <h2><i class="fas fa-cog"></i> è®¾ç½®</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: var(--text-dark);">æ—©ç¡æ—¶é—´è®¾ç½®</h3>
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <label style="font-weight: bold;">å¼€å§‹æ—¶é—´:</label>
                    <input type="time" id="sleep-start-time" value="21:00" style="padding: 8px; border-radius: 8px; border: 2px solid var(--dark-yellow);">
                </div>
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                    <label style="font-weight: bold;">ç»“æŸæ—¶é—´:</label>
                    <input type="time" id="sleep-end-time" value="22:50" style="padding: 8px; border-radius: 8px; border: 2px solid var(--dark-yellow);">
                </div>
                
                <h3 style="margin-bottom: 15px; color: var(--text-dark);">æ•°æ®ç®¡ç†</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="nav-btn" id="clear-photos-btn">
                        <i class="fas fa-trash"></i> æ¸…é™¤æ‰€æœ‰ç…§ç‰‡
                    </button>
                    <button class="nav-btn" id="clear-history-btn">
                        <i class="fas fa-history"></i> æ¸…é™¤æ‰“å¡å†å²
                    </button>
                    <button class="nav-btn" id="clear-all-btn" style="background-color: #ffebee; color: #c62828;">
                        <i class="fas fa-exclamation-triangle"></i> æ¸…é™¤æ‰€æœ‰æ•°æ®
                    </button>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="modal-close-btn" id="save-settings-btn">ä¿å­˜è®¾ç½®</button>
                <button class="nav-btn" id="close-settings-btn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" accept="image/*" capture="environment" class="file-input" id="photo-input">

    <script>
        // é¼“åŠ±è¯­æ•°æ®ï¼ˆå¸¦éŸ³é¢‘ï¼‰
        const encouragementMessages = [
            { 
                text: "æ™šå®‰ï¼Œæ˜å¤©ä¼šæ˜¯ç¾å¥½çš„ä¸€å¤©ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3",
                type: "early" 
            },
            { 
                text: "æ—©ç¡æ˜¯å¯¹è‡ªå·±æœ€å¥½çš„æŠ•èµ„ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3",
                type: "early" 
            },
            { 
                text: "å¥åº·çš„èº«ä½“ä»æ—©ç¡å¼€å§‹ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3",
                type: "early" 
            },
            { 
                text: "ä½ å·²ç»è¿ˆå‡ºäº†å¥åº·ç”Ÿæ´»çš„ç¬¬ä¸€æ­¥ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3",
                type: "early" 
            },
            { 
                text: "ä»Šå¤©æœ‰ç‚¹æ™šå“¦ï¼Œæ˜å¤©äº‰å–æ—©ç‚¹ç¡ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-1001.mp3",
                type: "late" 
            },
            { 
                text: "è™½ç„¶æ™šäº†ç‚¹ï¼Œä½†æ‰“å¡å°±æ˜¯è¿›æ­¥ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-game-over-470.mp3",
                type: "late" 
            },
            { 
                text: "ä½œæ¯ä¸è§„å¾‹è¦è°ƒæ•´å“¦ï¼Œæ˜å¤©åŠ æ²¹ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-game-over-470.mp3",
                type: "irregular" 
            },
            { 
                text: "è®°å¾—è°ƒæ•´ä½œæ¯æ—¶é—´å“¦ï¼", 
                audio: "https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-1001.mp3",
                type: "irregular" 
            }
        ];
        
        // å¾½ç« æ•°æ®
        const badges = [
            { id: 1, name: "åˆè¯•æ—©ç¡", icon: "fas fa-bed", description: "è¿ç»­æ—©ç¡3å¤©", unlocked: false, type: "early" },
            { id: 2, name: "åšæŒä¸€å‘¨", icon: "fas fa-calendar-week", description: "è¿ç»­æ—©ç¡7å¤©", unlocked: false, type: "early" },
            { id: 3, name: "åŠæœˆæˆå°±", icon: "fas fa-moon", description: "è¿ç»­æ—©ç¡15å¤©", unlocked: false, type: "early" },
            { id: 4, name: "æœˆçœ å¤§å¸ˆ", icon: "fas fa-crown", description: "è¿ç»­æ—©ç¡30å¤©", unlocked: false, type: "early" },
            { id: 5, name: "ä¹ æƒ¯å…»æˆ", icon: "fas fa-star", description: "æ€»æ‰“å¡30å¤©", unlocked: false, type: "total" },
            { id: 6, name: "æ‰“å¡è¾¾äºº", icon: "fas fa-trophy", description: "æ€»æ‰“å¡100å¤©", unlocked: false, type: "total" }
        ];
        
        // åº”ç”¨çŠ¶æ€
        let currentStreak = 0; // è¿ç»­æ—©ç¡å¤©æ•°
        let totalDays = 0; // æ€»æ‰“å¡å¤©æ•°
        let earlyDays = 0; // æ—©ç¡å¤©æ•°
        let clockedInToday = false;
        let todaySleepType = null; // "early", "late", "irregular"
        let currentEncouragementIndex = 0;
        let currentTime = new Date();
        let sleepStartTime = { hour: 21, minute: 0 }; // é»˜è®¤21:00
        let sleepEndTime = { hour: 22, minute: 50 }; // é»˜è®¤22:50
        let members = []; // æˆå‘˜æ•°æ®
        let photos = []; // ç…§ç‰‡æ•°æ®
        let clockHistory = []; // æ‰“å¡å†å²
        
        // DOMå…ƒç´ 
        const currentTimeEl = document.getElementById('current-time');
        const clockInBtn = document.getElementById('clock-in-btn');
        const membersStatusEl = document.getElementById('members-status');
        const photoScrollContainer = document.getElementById('photo-scroll-container');
        const successModal = document.getElementById('success-modal');
        const successMessage = document.getElementById('success-message');
        const streakDaysEl = document.getElementById('streak-days');
        const modalTitle = document.getElementById('modal-title');
        const modalStatusText = document.getElementById('modal-status-text');
        const encouragementAudio = document.getElementById('encouragement-audio');
        const statsPageBtn = document.getElementById('stats-page-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const homePage = document.getElementById('home-page');
        const statsPage = document.getElementById('stats-page');
        const happinessBtn = document.getElementById('happiness-btn');
        const happinessBtnStats = document.getElementById('happiness-btn-stats');
        const photoInput = document.getElementById('photo-input');
        const calendarEl = document.getElementById('calendar');
        const badgesContainer = document.getElementById('badges-container');
        const myStreakEl = document.getElementById('my-streak');
        const statusIndicator = document.getElementById('status-indicator');
        const weekRateEl = document.getElementById('week-rate');
        const monthRateEl = document.getElementById('month-rate');
        const totalDaysEl = document.getElementById('total-days');
        const monthProgressText = document.getElementById('month-progress-text');
        const monthProgressFill = document.getElementById('month-progress-fill');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const sleepStartTimeInput = document.getElementById('sleep-start-time');
        const sleepEndTimeInput = document.getElementById('sleep-end-time');
        const clearPhotosBtn = document.getElementById('clear-photos-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const addFriendBtn = document.getElementById('add-friend-btn');
        const resetDataBtn = document.getElementById('reset-data-btn');
        const exportDataBtn = document.getElementById('export-data-btn');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadDataFromLocalStorage();
            
            // å¦‚æœæ²¡æœ‰æˆå‘˜ï¼Œæ·»åŠ é»˜è®¤æˆå‘˜ï¼ˆè‡ªå·±ï¼‰
            if (members.length === 0) {
                addDefaultMember();
            }
            
            // åˆå§‹åŒ–é¡µé¢
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            updateTimeStatus();
            setInterval(updateTimeStatus, 60000);
            
            renderMembers();
            renderPhotoBackground();
            renderCalendar();
            renderBadges();
            updateStats();
            updateClockButton();
            
            // åŠ è½½è®¾ç½®
            loadSettings();
            
            // äº‹ä»¶ç›‘å¬
            clockInBtn.addEventListener('click', handleClockIn);
            statsPageBtn.addEventListener('click', showStatsPage);
            backToHomeBtn.addEventListener('click', showHomePage);
            happinessBtn.addEventListener('click', () => photoInput.click());
            happinessBtnStats.addEventListener('click', () => photoInput.click());
            photoInput.addEventListener('change', handlePhotoUpload);
            modalCloseBtn.addEventListener('click', () => {
                successModal.style.display = 'none';
                encouragementAudio.pause();
            });
            settingsBtn.addEventListener('click', () => settingsModal.style.display = 'flex');
            saveSettingsBtn.addEventListener('click', saveSettings);
            closeSettingsBtn.addEventListener('click', () => settingsModal.style.display = 'none');
            clearPhotosBtn.addEventListener('click', clearPhotos);
            clearHistoryBtn.addEventListener('click', clearHistory);
            clearAllBtn.addEventListener('click', clearAllData);
            addFriendBtn.addEventListener('click', addFriend);
            resetDataBtn.addEventListener('click', resetTodayData);
            exportDataBtn.addEventListener('click', exportData);
            
            // ç›‘å¬å³é”®ç‚¹å‡»åˆ é™¤æˆå‘˜
            membersStatusEl.addEventListener('contextmenu', function(e) {
                const memberCard = e.target.closest('.member-card');
                if (memberCard) {
                    e.preventDefault();
                    const memberId = parseInt(memberCard.dataset.id);
                    // ä¸èƒ½åˆ é™¤ç¬¬ä¸€ä¸ªæˆå‘˜ï¼ˆè‡ªå·±ï¼‰
                    if (memberId !== members[0].id) {
                        deleteMember(memberId);
                    }
                }
            });
        });
        
        // æ·»åŠ é»˜è®¤æˆå‘˜ï¼ˆè‡ªå·±ï¼‰- ä¿®å¤ç‰ˆ
        function addDefaultMember() {
            const defaultMember = {
                id: Date.now(),
                name: "æˆ‘",
                avatar: "ğŸŒ»", // ä½¿ç”¨å‘æ—¥è‘µè¡¨æƒ…ç¬¦å·
                isCreator: true,
                clockedIn: false,
                sleepType: null,
                streak: 0,
                todayComment: "è¿˜æœªæ‰“å¡"
            };
            
            members.push(defaultMember);
            saveMembersToLocalStorage();
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadDataFromLocalStorage() {
            // åŠ è½½æˆå‘˜æ•°æ®
            const savedMembers = localStorage.getItem('sleepClockMembers');
            if (savedMembers) {
                members = JSON.parse(savedMembers);
            } else {
                members = [];
            }
            
            // åŠ è½½ç…§ç‰‡æ•°æ®
            const savedPhotos = localStorage.getItem('sleepClockPhotos');
            if (savedPhotos) {
                photos = JSON.parse(savedPhotos);
            } else {
                photos = [];
            }
            
            // åŠ è½½æ‰“å¡å†å²
            const savedHistory = localStorage.getItem('sleepClockHistory');
            if (savedHistory) {
                clockHistory = JSON.parse(savedHistory);
            } else {
                clockHistory = [];
            }
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            const savedStreak = localStorage.getItem('sleepClockStreak');
            if (savedStreak) {
                currentStreak = parseInt(savedStreak);
            } else {
                currentStreak = 0;
            }
            
            const savedTotal = localStorage.getItem('sleepClockTotalDays');
            if (savedTotal) {
                totalDays = parseInt(savedTotal);
            } else {
                totalDays = 0;
            }
            
            const savedEarly = localStorage.getItem('sleepClockEarlyDays');
            if (savedEarly) {
                earlyDays = parseInt(savedEarly);
            } else {
                earlyDays = 0;
            }
            
            // åŠ è½½ä»Šæ—¥æ‰“å¡çŠ¶æ€
            const lastClockDate = localStorage.getItem('sleepClockLastDate');
            const today = new Date().toDateString();
            if (lastClockDate === today) {
                clockedInToday = true;
                
                // æ£€æŸ¥ç¡çœ ç±»å‹
                const lastClockType = localStorage.getItem('sleepClockLastType');
                todaySleepType = lastClockType || null;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateClockButton();
            }
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedStartTime = localStorage.getItem('sleepClockStartTime');
            const savedEndTime = localStorage.getItem('sleepClockEndTime');
            
            if (savedStartTime) {
                const [hour, minute] = savedStartTime.split(':');
                sleepStartTime = { hour: parseInt(hour), minute: parseInt(minute) };
                sleepStartTimeInput.value = savedStartTime;
            }
            
            if (savedEndTime) {
                const [hour, minute] = savedEndTime.split(':');
                sleepEndTime = { hour: parseInt(hour), minute: parseInt(minute) };
                sleepEndTimeInput.value = savedEndTime;
            }
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const startTime = sleepStartTimeInput.value;
            const endTime = sleepEndTimeInput.value;
            
            if (startTime && endTime) {
                const [startHour, startMinute] = startTime.split(':');
                const [endHour, endMinute] = endTime.split(':');
                
                sleepStartTime = { hour: parseInt(startHour), minute: parseInt(startMinute) };
                sleepEndTime = { hour: parseInt(endHour), minute: parseInt(endMinute) };
                
                localStorage.setItem('sleepClockStartTime', startTime);
                localStorage.setItem('sleepClockEndTime', endTime);
                
                updateTimeStatus();
                alert('è®¾ç½®å·²ä¿å­˜ï¼');
                settingsModal.style.display = 'none';
            }
        }
        
        // ä¿å­˜æˆå‘˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveMembersToLocalStorage() {
            localStorage.setItem('sleepClockMembers', JSON.stringify(members));
        }
        
        // ä¿å­˜ç…§ç‰‡æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function savePhotosToLocalStorage() {
            localStorage.setItem('sleepClockPhotos', JSON.stringify(photos));
        }
        
        // ä¿å­˜æ‰“å¡å†å²åˆ°æœ¬åœ°å­˜å‚¨
        function saveClockHistoryToLocalStorage() {
            localStorage.setItem('sleepClockHistory', JSON.stringify(clockHistory));
        }
        
        // æ›´æ–°å½“å‰æ—¶é—´
        function updateCurrentTime() {
            currentTime = new Date();
            const hours = currentTime.getHours().toString().padStart(2, '0');
            const minutes = currentTime.getMinutes().toString().padStart(2, '0');
            const seconds = currentTime.getSeconds().toString().padStart(2, '0');
            
            // åªæ˜¾ç¤ºæ—¶é—´ï¼Œä¸æ˜¾ç¤º"å½“å‰æ—¶é—´"å­—æ ·
            currentTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // æ›´æ–°æ—¶é—´çŠ¶æ€
        function updateTimeStatus() {
            const currentHour = currentTime.getHours();
            const currentMinute = currentTime.getMinutes();
            
            // è®¡ç®—å½“å‰æ—¶é—´ç±»å‹
            let sleepType = getSleepType(currentHour, currentMinute);
            let statusText = "";
            let statusClass = "";
            
            switch(sleepType) {
                case "early":
                    statusText = "æ—©ç¡æ—¶é—´";
                    statusClass = "early";
                    clockInBtn.className = "clock-in-btn pulse";
                    clockInBtn.textContent = "ç«‹å³æ‰“å¡";
                    break;
                case "late":
                    statusText = "æ™šç¡æ—¶é—´";
                    statusClass = "late";
                    clockInBtn.className = "clock-in-btn late pulse";
                    clockInBtn.textContent = "ç«‹å³æ‰“å¡";
                    break;
                default:
                    statusText = "ä½œæ¯ä¸è§„å¾‹";
                    statusClass = "irregular";
                    clockInBtn.className = "clock-in-btn irregular pulse";
                    clockInBtn.textContent = "ç«‹å³æ‰“å¡";
            }
            
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            if (statusIndicator) {
                const statusDot = statusIndicator.querySelector('.status-dot');
                statusDot.className = `status-dot ${statusClass}`;
                
                let timeText = "";
                switch(sleepType) {
                    case "early":
                        timeText = `æ—©ç¡æ—¶é—´ ${sleepStartTime.hour.toString().padStart(2, '0')}:${sleepStartTime.minute.toString().padStart(2, '0')}-${sleepEndTime.hour.toString().padStart(2, '0')}:${sleepEndTime.minute.toString().padStart(2, '0')}`;
                        break;
                    case "late":
                        timeText = "æ™šç¡æ—¶é—´ " + (sleepEndTime.hour.toString().padStart(2, '0')) + ":" + (sleepEndTime.minute.toString().padStart(2, '0')) + "ä»¥å";
                        break;
                    case "irregular":
                        timeText = "ä½œæ¯ä¸è§„å¾‹ å…¶ä»–æ—¶é—´";
                        break;
                }
                statusIndicator.innerHTML = `<span class="status-dot ${statusClass}"></span>${timeText}`;
            }
            
            // å¦‚æœä»Šå¤©å·²ç»æ‰“å¡ï¼Œæ›´æ–°æŒ‰é’®çŠ¶æ€
            if (clockedInToday) {
                updateClockButton();
            }
        }
        
        // è·å–ç¡çœ ç±»å‹
        function getSleepType(hour, minute) {
            const currentTimeInMinutes = hour * 60 + minute;
            const startTimeInMinutes = sleepStartTime.hour * 60 + sleepStartTime.minute;
            const endTimeInMinutes = sleepEndTime.hour * 60 + sleepEndTime.minute;
            
            // æ—©ç¡æ—¶é—´
            if (currentTimeInMinutes >= startTimeInMinutes && currentTimeInMinutes <= endTimeInMinutes) {
                return "early";
            }
            // æ™šç¡æ—¶é—´ï¼šç»“æŸæ—¶é—´ä»¥å
            else if (currentTimeInMinutes > endTimeInMinutes) {
                return "late";
            }
            // å…¶ä»–æ—¶é—´ï¼šä½œæ¯ä¸è§„å¾‹
            else {
                return "irregular";
            }
        }
        
        // æ›´æ–°æ‰“å¡æŒ‰é’®çŠ¶æ€
        function updateClockButton() {
            if (clockedInToday && todaySleepType) {
                clockInBtn.disabled = true;
                clockInBtn.classList.remove('pulse');
                
                switch(todaySleepType) {
                    case "early":
                        clockInBtn.textContent = "ä»Šæ—¥å·²æ‰“å¡ï¼ˆæ—©ç¡ âœ“ï¼‰";
                        clockInBtn.style.background = "linear-gradient(135deg, #4CAF50, #3d8b40)";
                        break;
                    case "late":
                        clockInBtn.textContent = "ä»Šæ—¥å·²æ‰“å¡ï¼ˆæ™šç¡ï¼‰";
                        clockInBtn.style.background = "linear-gradient(135deg, #FF5722, #d84315)";
                        break;
                    case "irregular":
                        clockInBtn.textContent = "ä»Šæ—¥å·²æ‰“å¡ï¼ˆä¸è§„å¾‹ï¼‰";
                        clockInBtn.style.background = "linear-gradient(135deg, #9E9E9E, #757575)";
                        break;
                }
            } else {
                clockInBtn.disabled = false;
                clockInBtn.classList.add('pulse');
            }
        }
        
        // å¤„ç†æ‰“å¡
        function handleClockIn() {
            const currentHour = currentTime.getHours();
            const currentMinute = currentTime.getMinutes();
            
            // åˆ¤æ–­ç¡çœ ç±»å‹
            todaySleepType = getSleepType(currentHour, currentMinute);
            clockedInToday = true;
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            totalDays++;
            
            if (todaySleepType === "early") {
                currentStreak++;
                earlyDays++;
            } else {
                // å¦‚æœä¸æ˜¯æ—©ç¡ï¼Œè¿ç»­æ—©ç¡å¤©æ•°æ¸…é›¶
                currentStreak = 0;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('sleepClockStreak', currentStreak.toString());
            localStorage.setItem('sleepClockTotalDays', totalDays.toString());
            localStorage.setItem('sleepClockEarlyDays', earlyDays.toString());
            localStorage.setItem('sleepClockLastDate', new Date().toDateString());
            localStorage.setItem('sleepClockLastType', todaySleepType);
            
            // æ·»åŠ åˆ°æ‰“å¡å†å²
            const today = new Date();
            const clockRecord = {
                date: today.toISOString().split('T')[0],
                year: today.getFullYear(),
                month: today.getMonth() + 1,
                day: today.getDate(),
                sleepType: todaySleepType
            };
            
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰ä»Šå¤©çš„è®°å½•
            const existingIndex = clockHistory.findIndex(record => 
                record.date === clockRecord.date
            );
            
            if (existingIndex === -1) {
                clockHistory.push(clockRecord);
            } else {
                clockHistory[existingIndex] = clockRecord;
            }
            
            saveClockHistoryToLocalStorage();
            
            // æ›´æ–°å½“å‰ç”¨æˆ·çŠ¶æ€
            if (members.length > 0) {
                members[0].clockedIn = true;
                members[0].sleepType = todaySleepType;
                members[0].streak = currentStreak;
                
                switch(todaySleepType) {
                    case "early":
                        members[0].todayComment = "æ—©ç¡æ‰“å¡æˆåŠŸï¼";
                        break;
                    case "late":
                        members[0].todayComment = "æ™šç¡æ‰“å¡å®Œæˆ";
                        break;
                    case "irregular":
                        members[0].todayComment = "ä½œæ¯ä¸è§„å¾‹æ‰“å¡";
                        break;
                }
                
                saveMembersToLocalStorage();
            }
            
            // æ›´æ–°UI
            updateClockButton();
            updateStats();
            
            // æ›´æ–°æ˜¾ç¤º
            renderMembers();
            renderCalendar();
            renderBadges();
            
            // æ˜¾ç¤ºæˆåŠŸå¼¹çª—å¹¶æ’­æ”¾é¼“åŠ±è¯­
            showSuccessModal(todaySleepType);
        }
        
        // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
        function showSuccessModal(sleepType) {
            // æ ¹æ®ç¡çœ ç±»å‹é€‰æ‹©é¼“åŠ±è¯­
            const filteredMessages = encouragementMessages.filter(msg => msg.type === sleepType);
            const randomIndex = Math.floor(Math.random() * filteredMessages.length);
            const selectedMessage = filteredMessages[randomIndex];
            
            // æ›´æ–°å¼¹çª—å†…å®¹
            streakDaysEl.textContent = currentStreak;
            
            let statusText = "";
            let statusColor = "";
            
            switch(sleepType) {
                case "early":
                    statusText = "æ—©ç¡æ‰“å¡æˆåŠŸï¼";
                    statusColor = "#4CAF50";
                    successMessage.innerHTML = `æ‚¨å·²è¿ç»­æ—©ç¡ <span id="streak-days">${currentStreak}</span> å¤©ï¼ç»§ç»­ä¿æŒï¼`;
                    break;
                case "late":
                    statusText = "æ™šç¡æ‰“å¡å®Œæˆ";
                    statusColor = "#FF5722";
                    successMessage.innerHTML = `ä»Šå¤©æœ‰ç‚¹æ™šå“¦ï¼Œè¿ç»­æ—©ç¡å¤©æ•°å·²é‡ç½®ã€‚<br>æ˜å¤©äº‰å–åœ¨${sleepStartTime.hour.toString().padStart(2, '0')}:${sleepStartTime.minute.toString().padStart(2, '0')}-${sleepEndTime.hour.toString().padStart(2, '0')}:${sleepEndTime.minute.toString().padStart(2, '0')}ä¹‹é—´æ‰“å¡ï¼`;
                    break;
                case "irregular":
                    statusText = "ä½œæ¯æ‰“å¡å®Œæˆ";
                    statusColor = "#9E9E9E";
                    successMessage.innerHTML = `ä½œæ¯æ—¶é—´ä¸è§„å¾‹å“¦ï¼<br>å»ºè®®è°ƒæ•´åˆ°${sleepStartTime.hour.toString().padStart(2, '0')}:${sleepStartTime.minute.toString().padStart(2, '0')}-${sleepEndTime.hour.toString().padStart(2, '0')}:${sleepEndTime.minute.toString().padStart(2, '0')}ä¹‹é—´ç¡è§‰~`;
                    break;
            }
            
            modalStatusText.textContent = statusText;
            modalStatusText.style.color = statusColor;
            
            // è®¾ç½®éŸ³é¢‘å¹¶æ’­æ”¾
            encouragementAudio.src = selectedMessage.audio;
            encouragementAudio.play();
            
            // æ˜¾ç¤ºå¼¹çª—ï¼ˆç°åœ¨æœ‰å…³é—­æŒ‰é’®ï¼‰
            successModal.style.display = 'flex';
        }
        
        // æ¸²æŸ“æˆå‘˜åˆ—è¡¨ - ä¿®å¤ç‰ˆ
        function renderMembers() {
            membersStatusEl.innerHTML = '';
            
            if (members.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-user-friends"></i>
                    <p>è¿˜æ²¡æœ‰å¥½å‹å“¦ï¼</p>
                `;
                membersStatusEl.appendChild(emptyState);
                return;
            }
            
            members.forEach(member => {
                const memberCard = document.createElement('div');
                
                // æ ¹æ®æ‰“å¡çŠ¶æ€è®¾ç½®æ ·å¼
                let cardClass = "member-card";
                if (member.clockedIn) {
                    if (member.sleepType === "early") {
                        cardClass += " clocked-in-early";
                    } else if (member.sleepType === "late") {
                        cardClass += " clocked-in-late";
                    } else if (member.sleepType === "irregular") {
                        cardClass += " clocked-in-irregular";
                    }
                }
                
                memberCard.className = cardClass;
                memberCard.dataset.id = member.id;
                
                // åˆ›å»ºè€…æ ‡è¯†
                const creatorBadge = member.isCreator ? 'ğŸ‘‘ ' : '';
                
                // å¤„ç†å¤´åƒ - ä¿®å¤ç‰ˆ
                let avatarContent = '';
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯è¡¨æƒ…ç¬¦å·ï¼ˆåŒ…å«å‘æ—¥è‘µğŸŒ»ï¼‰
                if (member.avatar && (member.avatar.includes('ğŸŒ»') || 
                    member.avatar.match(/[\u{1F300}-\u{1F9FF}]/u) || 
                    member.avatar.match(/[\u{2600}-\u{26FF}]/u))) {
                    
                    // æ˜¯è¡¨æƒ…ç¬¦å·
                    let avatarClass = 'member-avatar emoji';
                    if (member.avatar.includes('ğŸŒ»')) {
                        avatarClass += ' sunflower';
                    }
                    
                    avatarContent = `<div class="${avatarClass}">${member.avatar}</div>`;
                } else if (member.avatar && (member.avatar.startsWith('http') || member.avatar.startsWith('data:'))) {
                    // æ˜¯å›¾ç‰‡URLæˆ–Data URL
                    avatarContent = `<div class="member-avatar"><img src="${member.avatar}" alt="${member.name}"></div>`;
                } else {
                    // é»˜è®¤æƒ…å†µï¼Œä½¿ç”¨é¦–å­—æ¯ä½œä¸ºå¤´åƒ
                    const initial = member.name.charAt(0);
                    avatarContent = `<div class="member-avatar">${initial}</div>`;
                }
                
                memberCard.innerHTML = `
                    ${avatarContent}
                    <div class="member-info">
                        <h4>${creatorBadge}${member.name}</h4>
                        <p>${member.todayComment || (member.clockedIn ? "å·²æ‰“å¡" : "è¿˜æœªæ‰“å¡")}</p>
                        <div class="streak-badge">è¿ç»­ ${member.streak || 0} å¤©</div>
                    </div>
                `;
                
                membersStatusEl.appendChild(memberCard);
            });
        }
        
        // åˆ é™¤æˆå‘˜
        function deleteMember(memberId) {
            if (confirm("ç¡®å®šè¦åˆ é™¤æ­¤å¥½å‹å—ï¼Ÿ")) {
                members = members.filter(member => member.id !== memberId);
                saveMembersToLocalStorage();
                renderMembers();
            }
        }
        
        // æ·»åŠ å¥½å‹
        function addFriend() {
            const friendName = prompt("è¯·è¾“å…¥å¥½å‹çš„åå­—ï¼š");
            if (friendName && friendName.trim() !== "") {
                const emojis = ["ğŸ˜Š", "ğŸ˜´", "â­", "ğŸŒ™", "âœ¨", "ğŸŒŸ", "ğŸ’¤", "ğŸ˜", "ğŸ¤—", "ğŸ¥°"];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                const newMember = {
                    id: Date.now(),
                    name: friendName.trim(),
                    avatar: randomEmoji,
                    isCreator: false,
                    clockedIn: false,
                    sleepType: null,
                    streak: Math.floor(Math.random() * 10), // éšæœºè¿ç»­å¤©æ•°
                    todayComment: "è¿˜æœªæ‰“å¡"
                };
                
                members.push(newMember);
                saveMembersToLocalStorage();
                renderMembers();
                alert(`å¥½å‹ ${friendName} å·²æ·»åŠ ï¼`);
            }
        }
        
        // å¤„ç†ç…§ç‰‡ä¸Šä¼ 
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼');
                return;
            }
            
            // åˆ›å»ºæ–‡ä»¶é˜…è¯»å™¨
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // å°†å›¾ç‰‡æ•°æ®URLä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const newPhoto = {
                    id: Date.now(),
                    url: e.target.result, // ä½¿ç”¨Data URL
                    timestamp: new Date().toISOString()
                };
                
                photos.push(newPhoto);
                savePhotosToLocalStorage();
                renderPhotoBackground();
                
                alert('ç…§ç‰‡å·²ä¸Šä¼ ï¼é¡µé¢å°†æ›´æœ‰ç”Ÿæ´»æ°”æ¯~');
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                photoInput.value = '';
            };
            
            reader.onerror = function() {
                alert('è¯»å–å›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                photoInput.value = '';
            };
            
            // è¯»å–å›¾ç‰‡æ–‡ä»¶
            reader.readAsDataURL(file);
        }
        
        // æ¸…é™¤æ‰€æœ‰ç…§ç‰‡
        function clearPhotos() {
            if (confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç…§ç‰‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
                photos = [];
                savePhotosToLocalStorage();
                renderPhotoBackground();
                alert('æ‰€æœ‰ç…§ç‰‡å·²æ¸…é™¤ï¼');
            }
        }
        
        // æ¸…é™¤æ‰“å¡å†å²
        function clearHistory() {
            if (confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ‰“å¡å†å²å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
                clockHistory = [];
                saveClockHistoryToLocalStorage();
                renderCalendar();
                updateStats();
                alert('æ‰“å¡å†å²å·²æ¸…é™¤ï¼');
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm("âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æ‰“å¡å†å²ã€ç…§ç‰‡ã€å¥½å‹ã€ç»Ÿè®¡æ•°æ®ï¼‰ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ")) {
                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®
                localStorage.clear();
                
                // é‡ç½®æ‰€æœ‰å˜é‡
                currentStreak = 0;
                totalDays = 0;
                earlyDays = 0;
                clockedInToday = false;
                todaySleepType = null;
                members = [];
                photos = [];
                clockHistory = [];
                
                // é‡æ–°æ·»åŠ é»˜è®¤æˆå‘˜
                addDefaultMember();
                
                // é‡ç½®è®¾ç½®
                sleepStartTime = { hour: 21, minute: 0 };
                sleepEndTime = { hour: 22, minute: 50 };
                sleepStartTimeInput.value = "21:00";
                sleepEndTimeInput.value = "22:50";
                
                // é‡æ–°æ¸²æŸ“é¡µé¢
                updateClockButton();
                updateStats();
                renderMembers();
                renderPhotoBackground();
                renderCalendar();
                renderBadges();
                
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼é¡µé¢å·²é‡ç½®ã€‚');
                settingsModal.style.display = 'none';
            }
        }
        
        // é‡ç½®ä»Šæ—¥æ•°æ®
        function resetTodayData() {
            if (confirm("ç¡®å®šè¦é‡ç½®ä»Šæ—¥çš„æ‰“å¡æ•°æ®å—ï¼Ÿæ‚¨å¯ä»¥é‡æ–°æ‰“å¡ã€‚")) {
                clockedInToday = false;
                todaySleepType = null;
                
                // æ¸…é™¤ä»Šæ—¥çš„æ‰“å¡çŠ¶æ€
                localStorage.removeItem('sleepClockLastDate');
                localStorage.removeItem('sleepClockLastType');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateClockButton();
                
                // æ›´æ–°å½“å‰ç”¨æˆ·çŠ¶æ€
                if (members.length > 0) {
                    members[0].clockedIn = false;
                    members[0].sleepType = null;
                    members[0].todayComment = "è¿˜æœªæ‰“å¡";
                    saveMembersToLocalStorage();
                    renderMembers();
                }
                
                alert('ä»Šæ—¥æ‰“å¡æ•°æ®å·²é‡ç½®ï¼Œç°åœ¨å¯ä»¥é‡æ–°æ‰“å¡äº†ï¼');
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                stats: {
                    currentStreak: currentStreak,
                    totalDays: totalDays,
                    earlyDays: earlyDays
                },
                clockHistory: clockHistory,
                members: members,
                photosCount: photos.length,
                settings: {
                    sleepStartTime: sleepStartTime,
                    sleepEndTime: sleepEndTime
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `ç¡çœ æ‰“å¡æ•°æ®_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼');
        }
        
        // æ¸²æŸ“ç…§ç‰‡èƒŒæ™¯
        function renderPhotoBackground() {
            photoScrollContainer.innerHTML = '';
            
            // å¦‚æœæœ‰ç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡ï¼Œä¼˜å…ˆä½¿ç”¨
            if (photos.length > 0) {
                // é™åˆ¶æœ€å¤šæ˜¾ç¤º8å¼ ç…§ç‰‡ï¼Œé¿å…æ€§èƒ½é—®é¢˜
                const photosToShow = photos.slice(-8);
                
                // åˆ›å»ºä¸¤ä»½ç…§ç‰‡ä»¥ç¡®ä¿æ— ç¼æ»šåŠ¨
                for (let i = 0; i < 2; i++) {
                    photosToShow.forEach(photo => {
                        const img = document.createElement('img');
                        img.src = photo.url;
                        img.alt = "ä»Šæ—¥ä»½å¿«ä¹";
                        img.onerror = function() {
                            // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œç§»é™¤è¿™å¼ å›¾ç‰‡
                            this.style.display = 'none';
                        };
                        photoScrollContainer.appendChild(img);
                    });
                }
            } else {
                // å¦‚æœæ²¡æœ‰ç…§ç‰‡ï¼Œä½¿ç”¨é»˜è®¤ç”Ÿæ´»å›¾ç‰‡
                const defaultPhotos = [
                    "https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1540420773420-3366772f4999?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1493246507139-91e8fad9978e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ];
                
                // åˆ›å»ºä¸¤ä»½ç…§ç‰‡ä»¥ç¡®ä¿æ— ç¼æ»šåŠ¨
                for (let i = 0; i < 2; i++) {
                    defaultPhotos.forEach(url => {
                        const img = document.createElement('img');
                        img.src = url;
                        img.alt = "ç”Ÿæ´»ç¬é—´";
                        photoScrollContainer.appendChild(img);
                    });
                }
            }
        }
        
        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            calendarEl.innerHTML = '';
            
            // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarEl.appendChild(dayHeader);
            });
            
            // è·å–å½“å‰æ—¥æœŸ
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            // è®¡ç®—ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ 
            let firstDayIndex = firstDayOfMonth.getDay();
            
            // æ·»åŠ ä¸Šä¸ªæœˆçš„ç©ºç™½æ—¥
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarEl.appendChild(emptyDay);
            }
            
            // æ·»åŠ æœ¬æœˆæ—¥æœŸ
            for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                
                // æ ‡è®°ä»Šå¤©
                const dateStr = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                if (dateStr === today.toISOString().split('T')[0]) {
                    dayEl.classList.add('today');
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ‰“å¡è®°å½•
                const clockRecord = clockHistory.find(record => record.date === dateStr);
                
                if (clockRecord) {
                    if (clockRecord.sleepType === "early") {
                        dayEl.classList.add('clocked-early');
                    } else if (clockRecord.sleepType === "late") {
                        dayEl.classList.add('clocked-late');
                    } else if (clockRecord.sleepType === "irregular") {
                        dayEl.classList.add('clocked-irregular');
                    }
                }
                
                calendarEl.appendChild(dayEl);
            }
        }
        
        // æ¸²æŸ“å¾½ç« 
        function renderBadges() {
            badgesContainer.innerHTML = '';
            
            // æ›´æ–°å¾½ç« è§£é”çŠ¶æ€
            updateBadgeStatus();
            
            badges.forEach(badge => {
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${badge.unlocked ? '' : 'locked'}`;
                
                badgeEl.innerHTML = `
                    <div class="badge-icon">
                        <i class="${badge.icon}"></i>
                    </div>
                    <div class="badge-name">${badge.name}</div>
                `;
                
                if (badge.unlocked) {
                    badgeEl.title = badge.description + " âœ“";
                    badgeEl.style.cursor = 'pointer';
                    badgeEl.onclick = () => alert(`ğŸ‰ å·²è§£é”ï¼š${badge.description}`);
                } else {
                    badgeEl.title = "æœªè§£é”: " + badge.description;
                }
                
                badgesContainer.appendChild(badgeEl);
            });
        }
        
        // æ›´æ–°å¾½ç« çŠ¶æ€
        function updateBadgeStatus() {
            badges[0].unlocked = currentStreak >= 3;
            badges[1].unlocked = currentStreak >= 7;
            badges[2].unlocked = currentStreak >= 15;
            badges[3].unlocked = currentStreak >= 30;
            badges[4].unlocked = totalDays >= 30;
            badges[5].unlocked = totalDays >= 100;
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            // æ›´æ–°è¿ç»­æ—©ç¡å¤©æ•°
            if (myStreakEl) {
                myStreakEl.textContent = `${currentStreak}å¤©`;
            }
            
            // æ›´æ–°æ€»æ‰“å¡å¤©æ•°
            if (totalDaysEl) {
                totalDaysEl.textContent = `${totalDays}å¤©`;
            }
            
            // è®¡ç®—æœ¬æœˆæ•°æ®
            const today = new Date();
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            const monthDays = today.getDate();
            
            // æœ¬æœˆæ—©ç¡å¤©æ•°
            const monthClocks = clockHistory.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= monthStart && 
                       recordDate <= today && 
                       record.sleepType === "early";
            }).length;
            
            // æœ¬æœˆæ€»æ‰“å¡å¤©æ•°
            const monthTotalClocks = clockHistory.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= monthStart && recordDate <= today;
            }).length;
            
            // è®¡ç®—æœ¬å‘¨æ•°æ®
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            
            // æœ¬å‘¨æ—©ç¡å¤©æ•°
            const weekClocks = clockHistory.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= weekStart && 
                       recordDate <= today && 
                       record.sleepType === "early";
            }).length;
            
            const weekDays = today.getDay() === 0 ? 7 : today.getDay() + 1;
            
            // è®¡ç®—ç™¾åˆ†æ¯”
            const weekRate = weekDays > 0 ? Math.round((weekClocks / weekDays) * 100) : 0;
            const monthRate = monthDays > 0 ? Math.round((monthClocks / monthDays) * 100) : 0;
            
            // æ›´æ–°æ˜¾ç¤º
            if (weekRateEl) weekRateEl.textContent = `${weekRate}%`;
            if (monthRateEl) monthRateEl.textContent = `${monthRate}%`;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progressPercent = monthDays > 0 ? (monthClocks / monthDays) * 100 : 0;
            monthProgressText.textContent = `${monthClocks}/${monthDays}å¤©`;
            monthProgressFill.style.width = `${progressPercent}%`;
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡é¡µé¢
        function showStatsPage() {
            homePage.style.display = 'none';
            statsPage.style.display = 'block';
            renderCalendar();
            renderBadges();
            updateStats();
        }
        
        // æ˜¾ç¤ºä¸»é¡µ
        function showHomePage() {
            statsPage.style.display = 'none';
            homePage.style.display = 'block';
        }
        
        // åˆå§‹åŒ–æ—¶é—´çŠ¶æ€
        updateTimeStatus();
    </script>
</body>
</html>